<style>
    .input-precio { @apply w-full p-3 bg-slate-800 border border-slate-700 rounded-xl text-green-400 font-bold outline-none focus:ring-2 ring-green-500; }
</style>

<div id="view-proveedor" class="hidden">
    <div id="panel-config-precios" class="hidden bg-slate-900 p-6 rounded-3xl mb-4 border-2 border-green-900 shadow-2xl">
        <h2 class="text-white font-black text-xl mb-4 uppercase tracking-tighter">⚙️ Configura tus Precios</h2>
        <div class="space-y-4">
            <div>
                <label class="text-[10px] text-slate-400 font-bold">PRECIO DOMÉSTICO ($)</label>
                <input type="number" id="base-domestico" step="0.01" placeholder="Ej: 3.00" class="w-full p-3 bg-slate-800 border border-slate-700 rounded-xl text-green-400 font-bold outline-none">
            </div>
            <div>
                <label class="text-[10px] text-slate-400 font-bold">PRECIO INDUSTRIAL ($)</label>
                <input type="number" id="base-industrial" step="0.01" placeholder="Ej: 15.00" class="w-full p-3 bg-slate-800 border border-slate-700 rounded-xl text-green-400 font-bold outline-none">
            </div>
            <button onclick="guardarPrecios()" class="w-full bg-green-600 text-white p-4 rounded-2xl font-black shadow-lg">GUARDAR MI LISTA</button>
        </div>
    </div>

    <div id="main-proveedor" class="hidden">
        <div class="bg-slate-900 text-white p-5 rounded-2xl mb-4 flex justify-between items-center shadow-lg border-b-4 border-green-600">
            <div>
                <p class="text-[10px] text-slate-400" id="prov-id"></p>
                <p class="font-bold text-lg leading-tight" id="prov-name"></p>
                <button onclick="editarPrecios()" class="text-[10px] text-green-500 underline uppercase font-bold">Editar Precios</button>
            </div>
            <div class="text-right">
                <p class="text-[10px] text-slate-400 uppercase">Ganancias</p>
                <p class="text-xl font-black text-green-400" id="prov-saldo">$0.00</p>
            </div>
        </div>

        <div class="flex gap-2 mb-6">
            <button id="btn-estado" class="flex-1 bg-green-600 text-white p-4 rounded-2xl font-black text-xs shadow-md uppercase tracking-widest">Activo</button>
            <button onclick="cerrarSesion()" class="bg-slate-200 px-4 rounded-2xl text-slate-600">✕</button>
        </div>

        <h3 class="font-black text-slate-800 text-sm uppercase mb-4 flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Pedidos en tu zona
        </h3>
        <div id="lista-pedidos" class="space-y-4"></div>
    </div>
</div>

<script type="module">
    // ... (Firebase imports y config) ...

    async function initProveedor(data) {
        document.getElementById('view-loading').classList.add('hidden');
        document.getElementById('view-proveedor').classList.remove('hidden');
        
        // Si no tiene precios, mostramos el panel de configuración
        if (!data.precioDomestico) {
            document.getElementById('panel-config-precios').classList.remove('hidden');
        } else {
            document.getElementById('main-proveedor').classList.remove('hidden');
            mostrarPedidos(data);
        }

        document.getElementById('prov-name').innerText = data.nombre;
        document.getElementById('prov-id').innerText = data.appID;
    }

    window.guardarPrecios = async () => {
        const d = document.getElementById('base-domestico').value;
        const i = document.getElementById('base-industrial').value;
        
        if(!d || !i) return alert("Pon tus precios para continuar");

        await updateDoc(doc(db, "usuarios", auth.currentUser.uid), {
            precioDomestico: d,
            precioIndustrial: i
        });
        location.reload(); // Recargamos para que entre al panel principal
    };

    function mostrarPedidos(provData) {
        const q = query(collection(db, "pedidos"), where("estado", "==", "pendiente"), orderBy("fecha", "desc"));
        onSnapshot(q, (snapshot) => {
            const lista = document.getElementById('lista-pedidos');
            lista.innerHTML = "";
            snapshot.forEach(docSnap => {
                const p = docSnap.data();
                const precioSugerido = p.tipo === 'domestico' ? provData.precioDomestico : provData.precioIndustrial;
                
                lista.innerHTML += `
                    <div class="bg-white border-2 border-slate-100 p-5 rounded-3xl shadow-sm">
                        <div class="flex justify-between items-start mb-3">
                            <span class="bg-red-600 text-white text-[9px] font-black px-2 py-1 rounded shadow-sm uppercase">Nuevo</span>
                            <span class="text-xs font-black text-orange-600">Propina: $${p.propina}</span>
                        </div>
                        <p class="font-black text-xl text-slate-800 leading-tight">${p.cantidad} TANQUES ${p.color.toUpperCase()}</p>
                        <p class="text-xs font-bold text-slate-400 mb-4 uppercase">${p.tipo}</p>
                        
                        <div class="flex gap-2">
                            <button onclick="aceptarConPrecioBase('${docSnap.id}', '${precioSugerido}')" 
                                class="flex-1 bg-green-600 text-white p-4 rounded-xl font-black text-xs shadow-md">
                                ACEPTAR POR $${precioSugerido}
                            </button>
                            <button onclick="contraoferta('${docSnap.id}')" 
                                class="bg-slate-900 text-white p-4 rounded-xl font-black text-[10px]">
                                OTRA OFERTA
                            </button>
                        </div>
                    </div>`;
            });
        });
    }

    window.aceptarConPrecioBase = async (id, precio) => {
        await updateDoc(doc(db, "pedidos", id), {
            estado: 'aceptado',
            precioFinal: precio,
            proveedorID: document.getElementById('prov-id').innerText,
            fechaAceptado: new Date().toISOString()
        });
        alert("¡Pedido aceptado con tu precio base!");
    };
    
    // ... (Otras funciones de navegación y cerrar sesión) ...
</script>
